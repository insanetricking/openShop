class Heart {
  constructor() {
    this.hearts = [...document.querySelectorAll('.cards__heart')];
    this.hearts.forEach(heart => {
      heart.addEventListener('click', e => {
        this.change(e, heart);
      });
    });
  }

  change(e) {
    if (e.target.dataset.flag === 'true') {
      e.target.src = '../images/heart.svg';
      e.target.dataset.flag = false;
    } else {
      e.target.setAttribute('data-flag', true);
      e.target.src = '../images/heartRed.svg';
    }
  }

}

const heart = new Heart();

class Slider {
  constructor() {
    this.sliderInner = document.querySelector('.slider__inner');
    this.sliderLine = this.sliderInner.querySelector('.slider__line');
    this.sliderSlides = [...this.sliderLine.querySelectorAll('.slider__slide')];
    this.sliderPagination = this.sliderInner.querySelector('.slider__pagination');
    this.sliderRounds = [...this.sliderInner.querySelectorAll('.slider__round')];
    this.count = 0;
    this.x1 = null;
    this.y1 = null; //////////////////////// Click//////////////////////////

    this.init();
    window.addEventListener('resize', () => {
      this.init();
    });
    this.sliderPagination.addEventListener('click', e => {
      this.change(e);
    }); //////////////////////// Interval//////////////////////////

    this.intervalId = this.interval();
    this.sliderPagination.addEventListener('mouseover', () => {
      clearInterval(this.intervalId);
    });
    this.sliderPagination.addEventListener('mouseout', () => {
      this.intervalId = setInterval(() => {
        this.autoClick();
      }, 3000);
    }); //////////////////////// Touch//////////////////////////

    this.sliderInner.addEventListener('touchstart', e => {
      this.handleTouchStart(e);
      clearInterval(this.intervalId);
    }, false);
    this.sliderInner.addEventListener('touchmove', e => {
      this.handleTouchMove(e);
    }, false);
  }

  init() {
    this.width = this.sliderInner.offsetWidth;
    this.sliderLine.style.width = this.width * this.sliderSlides.length + 'px';
    this.sliderSlides.forEach(item => {
      item.style.width = this.width + 'px';
      item.style.height = 'auto';
    });
  }

  change(e) {
    if (e.target != this.sliderPagination) {
      this.sliderRounds.forEach((btn, index) => {
        btn.classList.remove('active');

        if (e.target === btn) {
          this.count = index;
          this.translate();
        }
      });
    }
  }

  translate() {
    this.sliderRounds[this.count].classList.add('active');
    this.sliderLine.style.transform = `translateX(-${this.count * this.width}px)`;
  }

  autoClick() {
    this.sliderRounds.forEach(btn => {
      btn.classList.remove('active');
    });
    this.count++;

    if (this.count >= this.sliderRounds.length) {
      this.count = 0;
      this.translate();
    } else {
      this.translate();
    }
  }

  handleTouchStart(e) {
    let touch = e.touches[0];
    this.x1 = touch.clientX;
    this.y1 = touch.clientY;
  }

  handleTouchMove(e) {
    if (!(this.x1 || this.y1)) {
      return false;
    }

    let touch = e.touches[0];
    let x2 = touch.clientX;
    let y2 = touch.clientY;
    let xDiff = x2 - this.x1;
    let yDiff = y2 - this.y1; // console.log(this.x1, x2);

    if (xDiff > 0) {
      //r
      this.sliderRounds.forEach(btn => {
        btn.classList.remove('active');
      });
      this.count--;

      if (this.count < 0) {
        this.count = this.sliderRounds.length - 1;
        this.sliderRounds[this.count].classList.add('active');
        this.sliderLine.style.transform = `translateX(-${this.count * this.width}px)`;
      }

      this.sliderRounds[this.count].classList.add('active');
      this.sliderLine.style.transform = `translateX(-${this.count * this.width}px)`;
    } else {
      //l
      this.autoClick();
    }

    this.x1 = null;
    this.y1 = null;
    this.intervalId = this.interval();
  }

  interval() {
    let id = setInterval(() => {
      this.autoClick();
    }, 3000);
    return id;
  }

}

let slider = new Slider();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2ZUhlYXJ0LmpzIiwic2xpZGVyLmpzIl0sIm5hbWVzIjpbIkhlYXJ0IiwiY29uc3RydWN0b3IiLCJoZWFydHMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaGVhcnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImNoYW5nZSIsInRhcmdldCIsImRhdGFzZXQiLCJmbGFnIiwic3JjIiwic2V0QXR0cmlidXRlIiwiU2xpZGVyIiwic2xpZGVySW5uZXIiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVyTGluZSIsInNsaWRlclNsaWRlcyIsInNsaWRlclBhZ2luYXRpb24iLCJzbGlkZXJSb3VuZHMiLCJjb3VudCIsIngxIiwieTEiLCJpbml0Iiwid2luZG93IiwiaW50ZXJ2YWxJZCIsImludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsInNldEludGVydmFsIiwiYXV0b0NsaWNrIiwiaGFuZGxlVG91Y2hTdGFydCIsImhhbmRsZVRvdWNoTW92ZSIsIndpZHRoIiwib2Zmc2V0V2lkdGgiLCJzdHlsZSIsImxlbmd0aCIsIml0ZW0iLCJoZWlnaHQiLCJidG4iLCJpbmRleCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRyYW5zbGF0ZSIsImFkZCIsInRyYW5zZm9ybSIsInRvdWNoIiwidG91Y2hlcyIsImNsaWVudFgiLCJjbGllbnRZIiwieDIiLCJ5MiIsInhEaWZmIiwieURpZmYiLCJpZCIsInNsaWRlciJdLCJtYXBwaW5ncyI6IkFBQ0EsTUFBQUEsS0FBQSxDQUFBO0FBQ0FDLEVBQUFBLFdBQUEsR0FBQTtBQUNBLFNBQUFDLE1BQUEsR0FBQSxDQUFBLEdBQUFDLFFBQUEsQ0FBQUMsZ0JBQUEsQ0FBQSxlQUFBLENBQUEsQ0FBQTtBQUdBLFNBQUFGLE1BQUEsQ0FBQUcsT0FBQSxDQUFBQyxLQUFBLElBQUE7QUFDQUEsTUFBQUEsS0FBQSxDQUFBQyxnQkFBQSxDQUFBLE9BQUEsRUFBQUMsQ0FBQSxJQUFBO0FBQ0EsYUFBQUMsTUFBQSxDQUFB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LFNBQUEsR0FBQSxlQUFBLEtBQUF4QixLQUFBLEdBQUEsS0FBQVksS0FBQSxLQUFBO0FBRUE7O0FBQ0EsV0FBQWIsWUFBQSxDQUFBLEtBQUFDLEtBQUEsRUFBQW9CLFNBQUEsQ0FBQUcsR0FBQSxDQUFBLFFBQUE7QUFDQSxXQUFBM0IsVUFBQSxDQUFBa0IsS0FBQSxDQUFBVSxTQUFBLEdBQUEsZUFBQSxLQUFBeEIsS0FBQSxHQUFBLEtBQUFZLEtBQUEsS0FBQTtBQUdBLEtBbkJBLE1BbUJBO0FBQ0E7QUFFQSxXQUFBSCxTQUFBO0FBQ0E7O0FBR0EsU0FBQVIsRUFBQSxHQUFBLElBQUE7QUFDQSxTQUFBQyxFQUFBLEdBQUEsSUFBQTtBQUVBLFNBQUFHLFVBQUEsR0FBQSxLQUFBQyxRQUFBLEVBQUE7QUFDQTs7QUFHQUEsRUFBQUEsUUFBQSxHQUFBO0FBQ0EsUUFBQTJCLEVBQUEsR0FBQXpCLFdBQUEsQ0FBQSxNQUFBO0FBQ0EsV0FBQUMsU0FBQTtBQUNBLEtBRkEsRUFFQSxJQUZBLENBQUE7QUFJQSxXQUFBd0IsRUFBQTtBQUNBOztBQS9LQTs7QUFrTEEsSUFBQUMsTUFBQSxHQUFBLElBQUF6QyxNQUFBLEVBQUEiLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5jbGFzcyBIZWFydCB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmhlYXJ0cyA9IFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2FyZHNfX2hlYXJ0JyldO1xyXG5cclxuICAgICAgIFxyXG4gICAgICAgIHRoaXMuaGVhcnRzLmZvckVhY2goaGVhcnQgPT57XHJcbiAgICAgICAgICAgIGhlYXJ0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlKGUsIGhlYXJ0KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZShlKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoZS50YXJnZXQuZGF0YXNldC5mbGFnID09PSAndHJ1ZScpe1xyXG4gICAgICAgICAgICBlLnRhcmdldC5zcmM9ICcuLi9pbWFnZXMvaGVhcnQuc3ZnJ1xyXG4gICAgICAgICAgICBlLnRhcmdldC5kYXRhc2V0LmZsYWcgPSBmYWxzZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZS50YXJnZXQuc2V0QXR0cmlidXRlKCdkYXRhLWZsYWcnLCB0cnVlKVxyXG4gICAgICAgICAgICBlLnRhcmdldC5zcmM9ICcuLi9pbWFnZXMvaGVhcnRSZWQuc3ZnJ1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmNvbnN0IGhlYXJ0ID0gbmV3IEhlYXJ0KCk7XHJcbiIsIlxyXG5jbGFzcyBTbGlkZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5zbGlkZXJJbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZXJfX2lubmVyJyk7XHJcbiAgICAgICAgdGhpcy5zbGlkZXJMaW5lID0gdGhpcy5zbGlkZXJJbm5lci5xdWVyeVNlbGVjdG9yKCcuc2xpZGVyX19saW5lJyk7XHJcbiAgICAgICAgdGhpcy5zbGlkZXJTbGlkZXMgPSBbLi4udGhpcy5zbGlkZXJMaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zbGlkZXJfX3NsaWRlJyldO1xyXG4gICAgICAgIHRoaXMuc2xpZGVyUGFnaW5hdGlvbiA9IHRoaXMuc2xpZGVySW5uZXIucXVlcnlTZWxlY3RvcignLnNsaWRlcl9fcGFnaW5hdGlvbicpO1xyXG4gICAgICAgIHRoaXMuc2xpZGVyUm91bmRzID0gWy4uLnRoaXMuc2xpZGVySW5uZXIucXVlcnlTZWxlY3RvckFsbCgnLnNsaWRlcl9fcm91bmQnKV07XHJcblxyXG4gICAgICAgIHRoaXMuY291bnQgPSAwO1xyXG5cclxuICAgICAgICB0aGlzLngxID0gbnVsbDtcclxuICAgICAgICB0aGlzLnkxID0gbnVsbDtcclxuXHJcblxyXG5cclxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gQ2xpY2svLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgICAgIHRoaXMuaW5pdCgpXHJcblxyXG5cclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmluaXQoKVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIHRoaXMuc2xpZGVyUGFnaW5hdGlvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlKGUpXHJcbiAgICAgICAgfSlcclxuXHJcblxyXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBJbnRlcnZhbC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgICAgIHRoaXMuaW50ZXJ2YWxJZCA9IHRoaXMuaW50ZXJ2YWwoKTsgXHJcblxyXG5cclxuICAgICAgICB0aGlzLnNsaWRlclBhZ2luYXRpb24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICB0aGlzLnNsaWRlclBhZ2luYXRpb24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NsaWNrKCk7XHJcbiAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgIH0pXHJcblxyXG5cclxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gVG91Y2gvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuICAgICAgICB0aGlzLnNsaWRlcklubmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVRvdWNoU3RhcnQoZSk7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKTtcclxuICAgICAgICB9LCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2xpZGVySW5uZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgKGUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVUb3VjaE1vdmUoZSk7XHJcbiAgICAgICAgfSwgZmFsc2UpO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMuc2xpZGVySW5uZXIub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgdGhpcy5zbGlkZXJMaW5lLnN0eWxlLndpZHRoID0gdGhpcy53aWR0aCAqIHRoaXMuc2xpZGVyU2xpZGVzLmxlbmd0aCArICdweCc7XHJcblxyXG4gICAgICAgIHRoaXMuc2xpZGVyU2xpZGVzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpdGVtLnN0eWxlLndpZHRoID0gdGhpcy53aWR0aCArICdweCc7XHJcbiAgICAgICAgICAgIGl0ZW0uc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nO1xyXG5cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZShlKSB7XHJcbiAgICAgICAgaWYgKGUudGFyZ2V0ICE9IHRoaXMuc2xpZGVyUGFnaW5hdGlvbikge1xyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2xpZGVyUm91bmRzLmZvckVhY2goKGJ0biwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQgPT09IGJ0bikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY291bnQgPSBpbmRleDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zbGF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHRyYW5zbGF0ZSgpIHtcclxuXHJcbiAgICAgICAgdGhpcy5zbGlkZXJSb3VuZHNbdGhpcy5jb3VudF0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblxyXG4gICAgICAgIHRoaXMuc2xpZGVyTGluZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWCgtJHt0aGlzLmNvdW50ICogdGhpcy53aWR0aH1weClgO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBhdXRvQ2xpY2soKSB7XHJcbiAgICAgICAgdGhpcy5zbGlkZXJSb3VuZHMuZm9yRWFjaChidG4gPT4ge1xyXG4gICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb3VudCsrO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jb3VudCA+PSB0aGlzLnNsaWRlclJvdW5kcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb3VudCA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNsYXRlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50cmFuc2xhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZVRvdWNoU3RhcnQoZSkge1xyXG5cclxuICAgICAgICBsZXQgdG91Y2ggPSBlLnRvdWNoZXNbMF07XHJcbiAgICAgICAgdGhpcy54MSA9IHRvdWNoLmNsaWVudFg7XHJcbiAgICAgICAgdGhpcy55MSA9IHRvdWNoLmNsaWVudFk7XHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICBoYW5kbGVUb3VjaE1vdmUoZSkge1xyXG5cclxuICAgICAgICBpZiAoISh0aGlzLngxIHx8IHRoaXMueTEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHRvdWNoID0gZS50b3VjaGVzWzBdO1xyXG5cclxuICAgICAgICBsZXQgeDIgPSB0b3VjaC5jbGllbnRYO1xyXG4gICAgICAgIGxldCB5MiA9IHRvdWNoLmNsaWVudFk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgbGV0IHhEaWZmID0geDIgLSB0aGlzLngxO1xyXG4gICAgICAgIGxldCB5RGlmZiA9IHkyIC0gdGhpcy55MTtcclxuXHJcbiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy54MSwgeDIpO1xyXG5cclxuICAgICAgICBpZiAoeERpZmYgPiAwKSB7XHJcbiAgICAgICAgICAgIC8vclxyXG5cclxuICAgICAgICAgICAgdGhpcy5zbGlkZXJSb3VuZHMuZm9yRWFjaChidG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jb3VudC0tO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb3VudCA8IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY291bnQgPSB0aGlzLnNsaWRlclJvdW5kcy5sZW5ndGggLSAxO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyUm91bmRzW3RoaXMuY291bnRdLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJMaW5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVYKC0ke3RoaXMuY291bnQgKiB0aGlzLndpZHRofXB4KWA7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2xpZGVyUm91bmRzW3RoaXMuY291bnRdLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICB0aGlzLnNsaWRlckxpbmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoLSR7dGhpcy5jb3VudCAqIHRoaXMud2lkdGh9cHgpYDtcclxuXHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vbFxyXG5cclxuICAgICAgICAgICAgdGhpcy5hdXRvQ2xpY2soKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB0aGlzLngxID0gbnVsbDtcclxuICAgICAgICB0aGlzLnkxID0gbnVsbDtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmludGVydmFsSWQgPSB0aGlzLmludGVydmFsKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGludGVydmFsKCl7XHJcbiAgICAgIGxldCBpZCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5hdXRvQ2xpY2soKTtcclxuICAgICAgICB9LCAzMDAwKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgfVxyXG59XHJcblxyXG5sZXQgc2xpZGVyID0gbmV3IFNsaWRlcigpOyJdfQ==
